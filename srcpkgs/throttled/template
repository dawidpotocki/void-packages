# Template file for 'throttled'
pkgname=throttled
version=0.7
revision=1
build_style=python3-module
conf_files="/etc/lenovo_fix.conf"
hostmakedepends="python3-setuptools"
depends="python3-dbus python3-gobject"
short_desc="Workaround for Intel throttling issues in Linux"
maintainer="Dawid Potocki <dawid@dawidpotocki.com>"
license="MIT"
homepage="https://github.com/erpalma/throttled"
distfiles="https://github.com/erpalma/throttled/archive/v${version}.tar.gz"
checksum=64f139b3fd6f13381105f30ed4598faa69e59bfd613d26dfde29f46578b0b2a1

pre_build() {
	sed -i "s/@VERSION@/${version}/" setup.py
}

post_install() {
	vinstall mmio.py 644 ${py3_sitelib}/lenovo_fix mmio.py
	vinstall lenovo_fix.py 644 ${py3_sitelib}/lenovo_fix lenovo_fix.py
	vconf etc/lenovo_fix.conf
	vsv lenovo_fix
	sed -i "s|@PATH@|${py3_sitelib}|" ${DESTDIR}/etc/sv/lenovo_fix/run
	vlicense LICENSE
}
